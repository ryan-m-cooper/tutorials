<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="shortcut icon" href="https://raw.githubusercontent.com/ohasselblad/workshops/master/img/favicon.ico" type="image/x-icon">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>Tuts &amp; Lessons : Tour of CartoDB APIs</title>
        <meta name="description" content="Little guides to mappy things and data stuffs from Ryan M Cooper">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/tutorials/css/syntax.css">
        <link rel="stylesheet" href="/tutorials/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <h4><a class=brand href="/tutorials/">Tuts &amp; Lessons</a>
    <small>Little guides to mappy things and data stuffs from Ryan M Cooper</small>
</h4>


                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <li class="nav-header"><a href="/tutorials/">Home</a></li>
    <li class="nav-header"><a href="/tutorials/speakers.html">Speaker Resources</a></li>
    <li class="nav-header"><a href="/tutorials/events.html">List Your Event</a></li>
    <li class="nav-header"><a href="/tutorials/submit.html">Submit Material</a></li>
    <li class="nav-header">Workshops</li>
    
         
         
            
            

            
        
        
    
         
         
            
            

             
                
                    <li class="inner">Data</li>
                
                <li class="leaf" data-order=""><a href="/tutorials/data/pva-parcel-lines.html">Getting Parcel Lines</a></li>
            
        
        
    
         
         
            
            

            
        
        
    
         
         
            
            

            
        
        
    
         
         
            
            

            
        
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h2>Tour of CartoDB APIs</h2>
    <small>Harvard Workshop</small>
</div>

<i>This intermediate tutorial was created by Andrew Hill on January 23, 2015 for .</i>

<h2 id="introduction-to-the-cartodb-interface">Introduction to the CartoDB interface</h2>

<p>This page can always be found at: http://bit.ly/cdb-harvard</p>

<ul>
  <li>Tour of dashboard</li>
  <li>Common data</li>
  <li>Uploading data</li>
  <li>Tour of table and map view</li>
  <li>Publishing maps</li>
  <li>Public profile</li>
</ul>

<h2 id="creating-your-accounts">Creating your accounts</h2>

<p>Set you up with accounts here, <a href="https://cartodb.com/signup?plan=academy">https://cartodb.com/signup?plan=academy</a>. This will give you a free upgrade to our <strong>student</strong> plan, since today, we are all students :)</p>

<h2 id="your-first-map-in-30-seconds">Your first map in 30 seconds!</h2>

<p>Today we are going to make a map of a very exciting topic! The other day I stumbled upon a really fun dataset of this guy,</p>

<h4 id="spencer-the-cat">Spencer the cat!</h4>

<p><img src="../img/harvard/spencer.jpg" alt="Spencer" /></p>

<p>I found this data in <a href="https://www.movebank.org/node/6892">Movebank</a>. The first thing we are going to do is import this dataset into our accounts.</p>

<p><a href="https://dl.dropboxusercontent.com/u/1307405/CartoDB/spencer_the_cat.geojson">Download Spencer the Cat</a></p>

<p><em>alternative</em>:</p>

<p>Cut&amp;paste the url:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html">https://dl.dropboxusercontent.com/u/1307405/CartoDB/spencer_the_cat.geojson</code></pre></div>

<p>Now, let’s use Spencer to take a look at a few things.</p>

<ul>
  <li>Table and map view</li>
  <li>Thematic maps!</li>
  <li>Custom styling data</li>
</ul>

<p><img src="../img/harvard/spencer_intensity.png" alt="spencer intensity" /></p>

<h2 id="introduction-to-cartocss">Introduction to CartoCSS</h2>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nf">#spencer_the_cat</span><span class="p">{</span>
  <span class="n">marker</span><span class="o">-</span><span class="n">fill</span><span class="o">:</span> <span class="k">transparent</span><span class="p">;</span>
  <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span><span class="m">24</span><span class="p">;</span>
  <span class="n">marker</span><span class="o">-</span><span class="n">line</span><span class="o">-</span><span class="k">color</span><span class="o">:</span> <span class="m">#FFFFFF</span><span class="p">;</span>
  <span class="n">marker</span><span class="o">-</span><span class="n">line</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">2</span><span class="o">.</span><span class="m">0</span><span class="p">;</span>
  <span class="n">marker</span><span class="o">-</span><span class="n">line</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">1</span><span class="o">.</span><span class="m">5</span><span class="p">;</span>
  <span class="n">marker</span><span class="o">-</span><span class="n">fill</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">9</span><span class="p">;</span>
  <span class="n">marker</span><span class="o">-</span><span class="n">comp</span><span class="o">-</span><span class="n">op</span><span class="o">:</span> <span class="n">src</span><span class="p">;</span>
  <span class="n">marker</span><span class="o">-</span><span class="n">type</span><span class="o">:</span> <span class="n">ellipse</span><span class="p">;</span>
  <span class="n">marker</span><span class="o">-</span><span class="n">placement</span><span class="o">:</span> <span class="n">point</span><span class="p">;</span>
  <span class="n">marker</span><span class="o">-</span><span class="n">allow</span><span class="o">-</span><span class="n">overlap</span><span class="o">:</span> <span class="n">true</span><span class="p">;</span>
  <span class="n">marker</span><span class="o">-</span><span class="k">clip</span><span class="o">:</span> <span class="n">false</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<h2 id="introduction-to-sql">Introduction to SQL</h2>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">cartodb_id</span><span class="p">,</span> <span class="n">the_geom</span><span class="p">,</span> <span class="n">the_geom_webmercator</span> <span class="k">FROM</span> <span class="n">spencer_the_cat</span></code></pre></div>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="s1">&#39;hi&#39;</span> <span class="k">as</span> <span class="n">hello</span> <span class="k">FROM</span> <span class="n">spencer_the_cat</span></code></pre></div>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;dow&#39;</span><span class="p">,</span><span class="n">study_local_timestamp</span><span class="p">)</span> <span class="k">as</span> <span class="n">d</span>
<span class="k">FROM</span> <span class="n">spencer_the_cat</span></code></pre></div>

<p><em>dow</em> here means ‘day of week’. 0-6 Sunday is 0</p>

<h4 id="lets-see-what-spencer-does-on-mondays">Let’s see what Spencer does on Mondays</h4>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;dow&#39;</span><span class="p">,</span><span class="n">study_local_timestamp</span><span class="p">)</span> <span class="k">as</span> <span class="n">d</span>
<span class="k">FROM</span> <span class="n">spencer_the_cat</span>
<span class="k">WHERE</span> <span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;dow&#39;</span><span class="p">,</span><span class="n">study_local_timestamp</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span></code></pre></div>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">ST_MakeLine</span><span class="p">(</span><span class="n">the_geom_webmercator</span><span class="p">)</span> <span class="k">as</span> <span class="n">the_geom_webmercator</span>
<span class="k">FROM</span> <span class="n">spencer_the_cat</span></code></pre></div>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">ST_MakeLine</span><span class="p">(</span><span class="n">the_geom_webmercator</span><span class="p">)</span> <span class="k">as</span> <span class="n">the_geom_webmercator</span> <span class="k">FROM</span> <span class="n">spencer_the_cat</span>
<span class="k">WHERE</span> <span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;dow&#39;</span><span class="p">,</span><span class="n">study_local_timestamp</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span></code></pre></div>

<p>Or! Let’s get all days and then use colors to distinguish them</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
  <span class="n">ST_MakeLine</span><span class="p">(</span><span class="n">the_geom_webmercator</span><span class="p">)</span> <span class="k">as</span> <span class="n">the_geom_webmercator</span><span class="p">,</span>
  <span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;dow&#39;</span><span class="p">,</span><span class="n">study_local_timestamp</span><span class="p">)</span> <span class="k">as</span> <span class="n">d</span>
<span class="k">FROM</span> <span class="n">spencer_the_cat</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;dow&#39;</span><span class="p">,</span><span class="n">study_local_timestamp</span><span class="p">)</span></code></pre></div>

<h4 id="writing-data">Writing data</h4>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">spencer_the_cat</span> <span class="k">SET</span> <span class="n">hod</span> <span class="o">=</span> <span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span><span class="n">study_local_timestamp</span><span class="p">)</span></code></pre></div>

<h2 id="torque">Torque!</h2>

<h4 id="a-quick-look-at-torque">A quick look at Torque</h4>

<p><strong>Point torque</strong></p>

<p><a href="https://team.cartodb.com/u/andrew/viz/cf1cc3e6-3242-11e4-8036-0e230854a1cb/public_map"><img src="../img/harvard/point_torque.png" alt="Point torque" /></a></p>

<p><strong>Categorical torque</strong></p>

<p><a href="https://team.cartodb.com/u/andrew/viz/508a7508-11e2-11e4-9973-0e73339ffa50/public_map"><img src="../img/harvard/categorical_torque.png" alt="Categorical torque" /></a></p>

<p><strong>Temporal bubbles</strong></p>

<p><a href="https://team.cartodb.com/u/andrew/viz/32ff4f28-7e51-11e4-9555-0e853d047bba/public_map"><img src="../img/harvard/temporal_bubbles.png" alt="Temporal bubbles" /></a></p>

<p><strong>Cumulative bubbles</strong></p>

<p><a href="http://team.cartodb.com/u/andrew/viz/a0a551a0-9b41-11e4-856f-0e853d047bba/embed_map"><img src="../img/harvard/cumulative_bubbles.png" alt="Cumulative bubbles" /></a></p>

<p><a href="http://gis.stackexchange.com/questions/129838/show-change-in-size-over-time/130114#130114">Method for creating the last two</a></p>

<h4 id="now-our-own-torque">Now our own Torque</h4>

<p><img src="../img/harvard/own_torque.gif" alt="Spencer torque" /></p>

<h1 id="guessing-spencers-house">Guessing Spencer’s house</h1>

<p>First, let’s take a look at one of my favorite datasets from MassGIS, the <a href="http://www.mass.gov/anf/research-and-tech/it-serv-and-support/application-serv/office-of-geographic-information-massgis/datalayers/ftpstructures.html">Building Structures dataset</a>. We can all download Cambridge and upload the file to our accounts.</p>

<p>Let’s rename the file, <code>cambridge_buildings</code></p>

<p>We can do some different things with polygons, let’s take a look.</p>

<h4 id="more-dynamic-sql">More dynamic SQL</h4>

<p><strong>CDB_LatLng</strong></p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
  <span class="o">*</span><span class="p">,</span> <span class="n">ST_Distance</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span> <span class="n">CDB_LatLng</span><span class="p">(</span><span class="mi">42</span><span class="p">.</span><span class="mi">374444</span><span class="p">,</span> <span class="o">-</span><span class="mi">71</span><span class="p">.</span><span class="mi">116944</span><span class="p">))</span> <span class="n">d</span>
<span class="k">FROM</span> <span class="n">cambridge_buildings</span></code></pre></div>

<p><strong>a map from dynamic sql</strong></p>

<p><img src="../img/harvard/dynamic_sql.png" alt="Dynamic SQL" /></p>

<p><strong>Order by distance</strong></p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">cambridge_buildings</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">the_geom</span> <span class="o">&lt;-&gt;</span> <span class="n">CDB_LatLng</span><span class="p">(</span><span class="mi">42</span><span class="p">.</span><span class="mi">374444</span><span class="p">,</span> <span class="o">-</span><span class="mi">71</span><span class="p">.</span><span class="mi">116944</span><span class="p">)</span> <span class="k">LIMIT</span> <span class="mi">65</span></code></pre></div>

<h4 id="a-quick-side-journey-into-the-sql-api">A quick side journey into the SQL API</h4>

<p>If you are building an application, you can actually do the same request over your API and get CSV, JSON, or GeoJSON results. Lets’ look at the default JSON,</p>

<div class="highlight"><pre><code class="language-html" data-lang="html">http://{username}.cartodb.com/api/v2/sql?q={SQL STATEMENT}</code></pre></div>

<p>For example,</p>

<div class="highlight"><pre><code class="language-html" data-lang="html">http://andrew.cartodb.com/api/v2/sql?q=SELECT * FROM cambridge_buildings ORDER BY the_geom <span class="nt">&lt;-&gt;</span> CDB_LatLng(42.374444, -71.116944) LIMIT 10</code></pre></div>

<p>It’s awesome. You can do it from JavaScript and it doesn’t even need to be about maps. Take a look at this <a href="http://bl.ocks.org/javisantana/7932459">column search built off a CartoDB table with placenames</a>.</p>

<h2 id="on-to-spencer">On to Spencer</h2>

<p>We’ll upload a second dataset now. This time, building footprints from <a href="http://www.mass.gov/anf/research-and-tech/it-serv-and-support/application-serv/office-of-geographic-information-massgis/datalayers/ftpstructures.html">MassGIS</a> website. Let’s download Andover, <code>https://gist.github.com/andrewxhill/7c1efd9bdead734010b0</code>. Now import it into your account.</p>

<h2 id="create-a-two-layer-visualization">Create a two layer visualization</h2>

<p><img src="../img/harvard/two_layer.png" alt="Two Layers" /></p>

<h2 id="delete-unneeded-buildings">Delete unneeded buildings</h2>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">structures_poly_9</span>
<span class="k">WHERE</span> <span class="k">NOT</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">ST_Extent</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">spencer_the_cat</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">the_geom</span></code></pre></div>

<h2 id="count-spencer-visits">Count spencer visits</h2>

<p>Add a new column called <code>spencer_n</code> of type <code>numeric</code> in our <code>structures_poly_9</code> table.</p>

<p><img src="../img/harvard/add_column.png" alt="Add Column" /></p>

<h4 id="spatial-analysis-of-spencer-">Spatial analysis of Spencer :)</h4>

<p>Let’s count how many times spencer was likely inside each house,</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">structures_poly_9</span>
<span class="k">SET</span> <span class="n">spencer_n</span> <span class="o">=</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
   <span class="k">FROM</span> <span class="n">spencer_the_cat</span>
  <span class="k">WHERE</span> <span class="n">ST_Intersects</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span> <span class="n">structures_poly_9</span><span class="p">.</span><span class="n">the_geom</span><span class="p">))</span></code></pre></div>

<p><img src="../img/harvard/touches.png" alt="Spencer house touches" /></p>

<h4 id="lets-look-at-house-touches">Let’s look at house ‘touches’</h4>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
  <span class="n">cartodb_id</span><span class="p">,</span>
  <span class="n">ST_MakeLine</span><span class="p">(</span>
    <span class="n">the_geom_webmercator</span><span class="p">,</span>
    <span class="n">ST_Centroid</span><span class="p">((</span>
      <span class="k">SELECT</span> <span class="n">the_geom_webmercator</span> <span class="k">FROM</span> <span class="n">structures_poly_9</span>
      <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">the_geom</span><span class="o">&lt;-&gt;</span><span class="n">spencer_the_cat</span><span class="p">.</span><span class="n">the_geom</span>
      <span class="k">LIMIT</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">)</span> <span class="k">AS</span> <span class="n">the_geom_webmercator</span><span class="p">,</span>
  <span class="n">hod</span>
<span class="k">FROM</span>
  <span class="n">spencer_the_cat</span></code></pre></div>

<h1 id="cartodbjs">CartoDB.js</h1>

<p>Let’s all start with the same template, you can download an index.html file here,</p>

<p><a href="https://gist.github.com/andrewxhill/ae73aa593d9a258f785a/download">index.html</a></p>

<h3 id="the-simplest-cartodbjs-map---createvis">The simplest CartoDB.js map - createVis</h3>

<p>A map in <a href="http://docs.cartodb.com/cartodb-platform/cartodb-js.html#create-a-visualization-from-scratch">one line of JavaScript</a></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">cartodb</span><span class="p">.</span><span class="nx">createVis</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span><span class="s1">&#39;http://team.cartodb.com/api/v2/viz/f6b0e824-a2fe-11e4-8f13-0e018d66dc29/viz.json&#39;</span><span class="p">);</span></code></pre></div>

<p><img src="../img/harvard/snippet.png" alt="Code snippet" /></p>

<p>Now, add your own vis.json URL.</p>

<h3 id="using-an-existing-leaflet-map">Using an existing Leaflet map</h3>

<p>We often want to make layers for maps in CartoDB and add them to our existing maps or projects. In this example, let’s create a webpage with a blank leaflet map. We’ll use one of the free to use <a href="http://cartodb.com/basemaps">CartoDB Basemaps</a> for this.</p>

<p>First, make sure you delete the line we added above and create a leaflet map object,</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">zoomControl</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">42.67</span><span class="p">,</span> <span class="o">-</span><span class="mf">71.23</span><span class="p">],</span>
    <span class="nx">zoom</span><span class="o">:</span> <span class="mi">15</span>
<span class="p">});</span></code></pre></div>

<p>Next, add a CartoDB Basemap</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">(</span><span class="s1">&#39;http://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}.png&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">attribution</span><span class="o">:</span> <span class="s1">&#39;&amp;copy; &lt;a href=&quot;http://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors, &amp;copy; &lt;a href=&quot;http://cartodb.com/attributions&quot;&gt;CartoDB&lt;/a&gt;&#39;</span>
    <span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span></code></pre></div>

<p>Let’s save the file and refresh.</p>

<p>Using the <a href="http://docs.cartodb.com/cartodb-platform/cartodb-js.html#adding-cartodb-layers-to-an-existing-map">createLayer</a> method, we can now add our map of Spencer. Let’s start with just a simple point map of Spencer.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">cartodb</span><span class="p">.</span><span class="nx">createLayer</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="s1">&#39;{your-vis-json-url-here}&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">layer</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Do further things here</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span></code></pre></div>

<h5 id="add-interactivity">Add interactivity</h5>

<p>You can add interactivity in the Editor very easily, but for maps you are creating on the fly in CartoDB.js, you can also add custom interactivity.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">lots</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">getSubLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nx">lots</span><span class="p">.</span><span class="nx">setInteractivity</span><span class="p">(</span><span class="s1">&#39;cartodb_id, hod&#39;</span><span class="p">);</span>
<span class="nx">lots</span><span class="p">.</span><span class="nx">setInteraction</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span></code></pre></div>

<h5 id="add-custom-interaction">Add custom interaction</h5>

<p>You can use cursor events on your polygons (e.g. featureClick, featureOver, featureOut) to create your own actions on your webpage. Let’s log the Elevation value for any lot we hover over</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">lots</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;featureOver&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">pos</span><span class="p">,</span> <span class="nx">pixel</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hour: &quot;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">hod</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>

<h3 id="integrating-interfaces">Integrating interfaces</h3>

<p>Using that button, <strong>Do Something</strong>, we can let the user interact with the data on the map in ways that no other service on the web can do it! Let’s start with the basics…</p>

<h4 id="create-button-to-set-filter">Create button to set filter</h4>

<p>Here, let’s create a button so that when a user clicks it, we filter to just Spencer’s activities in the evening.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">spencer</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">getSubLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#btn li&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">new_sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM spencer_the_cat WHERE hod &gt; 18&quot;</span><span class="p">;</span>
    <span class="nx">spencer</span><span class="p">.</span><span class="nx">setSQL</span><span class="p">(</span><span class="nx">new_sql</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>

<h4 id="change-the-button-to-modify-the-style">Change the button to modify the style</h4>

<p>Just like changing the SQL on the fly, we can change the entire style of our map:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">spencer</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">getSubLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#btn li&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">new_cartocss</span> <span class="o">=</span> <span class="s2">&quot;#spencer_the_cat{marker-fill-opacity: 0.8; marker-line-width: 0; marker-width: 10; marker-fill: #F2D2D3; marker-allow-overlap:true; [hod &gt; 18]{marker-fill: #3232FF;}}&quot;</span><span class="p">;</span>
    <span class="nx">spencer</span><span class="p">.</span><span class="nx">setCartoCSS</span><span class="p">(</span><span class="nx">new_cartocss</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>

<h4 id="style-and-sql-at-the-same-time">Style and SQL at the same time</h4>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">spencer</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">getSubLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#btn li&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">new_sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM spencer_the_cat WHERE hod &gt; 18&quot;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">new_cartocss</span> <span class="o">=</span> <span class="s2">&quot;#spencer_the_cat{marker-fill-opacity: 0.8; marker-line-width: 0; marker-width: 10; marker-fill: #F2D2D3; marker-allow-overlap:true; [hod &gt; 18]{marker-fill: #3232FF;}}&quot;</span><span class="p">;</span>
    <span class="nx">spencer</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="nx">sql</span><span class="o">:</span> <span class="nx">new_sql</span><span class="p">,</span> <span class="nx">cartocss</span><span class="o">:</span> <span class="nx">new_cartocss</span><span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h4 id="add-an-undo-button">Add an Undo button</h4>

<p>Of course, it would be handy if we let our users return to the default map after they click the button. Let’s make that happen.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">spencer</span> <span class="o">=</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">getSubLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#btn li&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#first&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;undo&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">new_sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM spencer_the_cat WHERE hod &gt; 18&quot;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">new_cartocss</span> <span class="o">=</span> <span class="s2">&quot;#spencer_the_cat{marker-fill-opacity: 0.8; marker-line-width: 0; marker-width: 10; marker-fill: #F2D2D3; marker-allow-overlap:true; [hod &gt; 18]{marker-fill: #3232FF;}}&quot;</span><span class="p">;</span>
        <span class="nx">spencer</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="nx">sql</span><span class="o">:</span> <span class="nx">new_sql</span><span class="p">,</span> <span class="nx">cartocss</span><span class="o">:</span> <span class="nx">new_cartocss</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#first&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Do Something&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">new_sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM spencer_the_cat&quot;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">new_cartocss</span> <span class="o">=</span> <span class="s2">&quot;#spencer_the_cat{marker-fill-opacity:0.8;marker-line-color:#FFF;marker-line-width:0;marker-line-opacity:1;marker-width:10;marker-fill:#C1373C;marker-allow-overlap:true;}&quot;</span><span class="p">;</span>
        <span class="nx">spencer</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="nx">sql</span><span class="o">:</span> <span class="nx">new_sql</span><span class="p">,</span> <span class="nx">cartocss</span><span class="o">:</span> <span class="nx">new_cartocss</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p><img src="../img/harvard/smiley.svg" alt="smiley" /></p>



                    </div>
                
            </div>

            

            <div class=row-fluid>
                <div id=footer class=span12>
                    Documentation for <a href="https://github.com/ryan-m-cooper/tutorials">Tuts &amp; Lessons</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
    </body>
</html>
