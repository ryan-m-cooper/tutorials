<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="shortcut icon" href="https://raw.githubusercontent.com/ohasselblad/workshops/master/img/favicon.ico" type="image/x-icon">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>Tuts &amp; Lessons : CartoDB at Cornell</title>
        <meta name="description" content="Little guides to mappy things and data stuffs from Ryan M Cooper">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/tutorials/css/syntax.css">
        <link rel="stylesheet" href="/tutorials/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <h4><a class=brand href="/tutorials/">Tuts &amp; Lessons</a>
    <small>Little guides to mappy things and data stuffs from Ryan M Cooper</small>
</h4>


                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <li class="nav-header"><a href="/tutorials/">Home</a></li>
    <li class="nav-header"><a href="/tutorials/speakers.html">Speaker Resources</a></li>
    <li class="nav-header"><a href="/tutorials/events.html">List Your Event</a></li>
    <li class="nav-header"><a href="/tutorials/submit.html">Submit Material</a></li>
    <li class="nav-header">Workshops</li>
    
         
         
            
            

            
        
        
    
         
         
            
            

             
                
                    <li class="inner">Data</li>
                
                <li class="leaf" data-order=""><a href="/tutorials/data/pva-parcel-lines.html">Getting Parcel Lines</a></li>
            
        
        
    
         
         
            
            

            
        
        
    
         
         
            
            

            
        
        
    
         
         
            
            

            
        
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h2>CartoDB at Cornell</h2>
    <small>Mapping Cornell's Trees</small>
</div>

<i>This introductory tutorial was created by Andy Eschbacher on May 11, 2015 for .</i>

<h2 id="intro-to-cartodb">Intro to CartoDB</h2>

<h3 id="andy-eschbacher-map-scientist-cartodb">Andy Eschbacher, Map Scientist, CartoDB</h3>

<h4 id="eschbachercartodbcom-mrephysics">eschbacher@cartodb.com, @MrEPhysics</h4>

<h3 id="may-11-2015">May 11, 2015</h3>

<h2 id="find-this-document-here">Find this document here:</h2>

<h2 id="bitlycdb-cornell">bit.ly/cdb-cornell</h2>

<h2 id="a-quick-introduction-to-cartodb">A quick introduction to CartoDB</h2>

<p>We aim to make the creation and sharing of maps as easy as possible. We also want to help you make beautiful, informative maps that make an impact and tell the stories that need to be told. Our beginnings lie in openness and the idea that every dataset has a story waiting to be told. We want to expose more than the lat/long.</p>

<h2 id="todays-goal----make-this-map">Today’s goal – make this map</h2>

<iframe width="100%" height="520" frameborder="0" src="https://team.cartodb.com/u/eschbacher/viz/a285e9f8-f771-11e4-b819-0e4fddd5de28/embed_map" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen="" oallowfullscreen="" msallowfullscreen=""></iframe>

<h2 id="some-of-my-favorite-stuff">Some of my favorite stuff</h2>

<h3 id="torque----animated-maps">Torque – animated maps</h3>

<p>My favorite: <a href="http://cartodb.s3.amazonaws.com/static_vizz/sunrise.html?title=true&amp;description=true&amp;search=false&amp;shareable=true&amp;cartodb_logo=true&amp;layer_selector=false&amp;legends=false&amp;scrollwheel=true&amp;sublayer_options=1%7C1&amp;sql=&amp;zoom=2&amp;center_lat=22.917922936146045&amp;center_lon=51.328125#">Map showing tweets that mention sunrise</a></p>

<p><img src="http://i.imgur.com/DkXR8eS.gif" alt="tweets mentioning sunrise" /></p>

<p>Boston Crime bubbles</p>

<p><a href="https://team.cartodb.com/u/andrew/viz/32ff4f28-7e51-11e4-9555-0e853d047bba/public_map"><img src="http://i.imgur.com/l4l0Bzr.png" alt="boston crime in torque" /></a></p>

<p>Alcatraz Escape</p>

<p><a href="http://www.washingtonpost.com/news/morning-mix/wp/2014/12/15/the-alcatraz-escapees-could-have-survived-and-this-interactive-model-proves-it/">Alcatraz Escape revisited</a></p>

<h3 id="odyssey----storytelling-with-maps">Odyssey – storytelling with maps</h3>

<p>Aurelia’s tour of lakes adversely effected by humans</p>

<p><a href="http://bl.ocks.org/auremoser/raw/d2e883314470768a07f8/"><img src="http://i.imgur.com/klShR3l.png" alt="Aurelia's Odyssey" /></a></p>

<p><em>Source code</em> <a href="http://bl.ocks.org/auremoser/d2e883314470768a07f8/">here</a>.</p>

<h3 id="satellite-imagery----new-and-exciting-for-me">Satellite imagery – new and exciting for me</h3>

<p>Digital Globe</p>

<p>We just partnered with Digital Globe to provide their high resolution, high coverage satellite and aerial imagery of the world available for building maps.</p>

<p>Here are some prototypes we made last week:</p>

<p><img src="http://cartodb-libs.global.ssl.fastly.net/cartodb.com/assets/img/backgrounds/solutions/digital-globe.dc222e05.jpg" alt="Burning Man" /></p>

<p><a href="http://mashable.com/2015/04/17/elon-musk-gigafactory/"><img src="http://i.imgur.com/y0cmQtA.png" alt="Gigafactory" /></a></p>

<p><a href="https://team.cartodb.com/u/eschbacher/viz/4cd6d042-ea5d-11e4-bcba-0e9d821ea90d/public_map"><img src="http://i.imgur.com/pSxKk2p.png" alt="Columbia Glacier" /></a>
High resolution glacier images (to the meter or 30 cm scale) with a good cadence.</p>

<h2 id="getting-started">Getting started</h2>

<h3 id="setting-us-up-for-accounts">Setting us up for accounts</h3>

<p>If you don’t have an account, go here to sign up: https://cartodb.com/signup?plan=academy</p>

<p>These are academic accounts that are better than the normal free accounts. If you have a free account already but don’t have the academic one, send me an email (eschbacher@cartodb.com) and I’ll bump you up. For now they have 50% more storage, but soon they’ll have 100% more and table syncing.</p>

<h3 id="datasets">Datasets</h3>

<h4 id="cornell-trees">Cornell Trees</h4>
<p>A dataset of the inventoried trees on Cornell’s campus from <a href="https://github.com/kgjenkins/trees">Keith’s GitHub repo</a>.</p>

<p>Copy the following link and paste it into your importer</p>

<div class="highlight"><pre><code class="language-html" data-lang="html">https://github.com/kgjenkins/trees/blob/master/Cornell_trees.zip?raw=true</code></pre></div>

<p>You should see the following on import:</p>

<p><img src="http://i.imgur.com/6RGhhyx.gif" alt="Import dataset" /></p>

<h4 id="building-footprints-for-tompkins-county">Building footprints for Tompkins County</h4>
<p>Originally from <a href="http://cugir.mannlib.cornell.edu/mapsheet.jsp?code=109&amp;code=tcco">http://cugir.mannlib.cornell.edu/mapsheet.jsp?code=109&amp;code=tcco</a>, but with some processing to add information about the trees in the Cornell dataset.</p>

<p>Copy the following link and paste it into your importer</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">https://www.dropbox.com/s/9osh79xluhgoyeq/cornell_buildings_w_trees.csv?dl=1</code></pre></div>

<h3 id="exploring-different-ways-of-visualizing-the-data">Exploring different ways of visualizing the data</h3>

<h4 id="simple-map-visualizing-all-trees">Simple map visualizing all trees</h4>

<p><img src="http://i.imgur.com/CD1flyi.png" alt="simple map of trees" /></p>

<h4 id="category-on-genus">Category on genus</h4>

<p><img src="http://i.imgur.com/t0Kjbuy.jpg" alt="Category" /></p>

<h4 id="bubble-on-the-tree-diameter-at-breast-height">Bubble on the tree diameter at breast height</h4>

<p><img src="http://i.imgur.com/pT4vAfY.png" alt="bubble map" /></p>

<h4 id="torque-category">Torque category</h4>

<p><img src="http://i.imgur.com/ME6IHXs.gif" alt="Torque category" /></p>

<h3 id="combining-visualization-styles">Combining visualization styles</h3>

<p>To combine the baked-in map types, we need to do some customization. We do this by opening up the CartoCSS tray and either alter the CartoCSS directly or cut and paste pieces from visualizations we like.</p>

<h4 id="choose-category-and-size-to-dbh-to-your-liking">Choose ‘category’ and size to <code>dbh</code> to your liking</h4>

<p>Copy all of the CartoCSS below the first block.</p>

<p>I’m using this CartoCSS (feel free to copy and paste it instead):</p>

<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nf">#cornell_trees</span> <span class="o">[</span> <span class="nt">dbh</span> <span class="o">&lt;=</span> <span class="nt">79</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">10</span><span class="o">.</span><span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cornell_trees</span> <span class="o">[</span> <span class="nt">dbh</span> <span class="o">&lt;=</span> <span class="nt">46</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">9</span><span class="o">.</span><span class="m">2</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cornell_trees</span> <span class="o">[</span> <span class="nt">dbh</span> <span class="o">&lt;=</span> <span class="nt">37</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">8</span><span class="o">.</span><span class="m">4</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cornell_trees</span> <span class="o">[</span> <span class="nt">dbh</span> <span class="o">&lt;=</span> <span class="nt">30</span><span class="nc">.5</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">7</span><span class="o">.</span><span class="m">7</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cornell_trees</span> <span class="o">[</span> <span class="nt">dbh</span> <span class="o">&lt;=</span> <span class="nt">23</span><span class="nc">.5</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">6</span><span class="o">.</span><span class="m">9</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cornell_trees</span> <span class="o">[</span> <span class="nt">dbh</span> <span class="o">&lt;=</span> <span class="nt">17</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">6</span><span class="o">.</span><span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cornell_trees</span> <span class="o">[</span> <span class="nt">dbh</span> <span class="o">&lt;=</span> <span class="nt">11</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">5</span><span class="o">.</span><span class="m">3</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cornell_trees</span> <span class="o">[</span> <span class="nt">dbh</span> <span class="o">&lt;=</span> <span class="nt">5</span><span class="nc">.5</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">4</span><span class="o">.</span><span class="m">6</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cornell_trees</span> <span class="o">[</span> <span class="nt">dbh</span> <span class="o">&lt;=</span> <span class="nt">4</span><span class="nc">.1</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">3</span><span class="o">.</span><span class="m">8</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#cornell_trees</span> <span class="o">[</span> <span class="nt">dbh</span> <span class="o">&lt;=</span> <span class="nt">2</span><span class="nc">.9</span><span class="o">]</span> <span class="p">{</span>
   <span class="n">marker</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">3</span><span class="o">.</span><span class="m">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<h4 id="next-choose-category-and-use-the-genus-column">Next choose category and use the <code>genus</code> column</h4>

<p>Paste the CartoCSS from your bubble map at the very bottom of the CartoCSS you have for category. Don’t delete anything, just add it to the bottom.</p>

<p>We’ll get a map that looks like this:</p>

<p><img src="http://i.imgur.com/YnsJj3A.jpg" alt="Trees categorized by genus, sized by diameter" /></p>

<h2 id="multilayer-map">Multilayer Map</h2>

<p>Let’s upload a new dataset now. I originally got the building footprints from <a href="http://cugir.mannlib.cornell.edu/mapsheet.jsp?code=109&amp;code=tcco">here</a> but we will used some data that I processed instead.</p>

<p>But I prepared a derivative of this data that gives the number of trees within 10 meters of any of the buildings on the Cornell campus.</p>

<p>Let’s create a new layer to our map by clicking on <code>+ ADD LAYER</code> above the tray on the right. Next click on “data file” and then paste in the following URL:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">https://www.dropbox.com/s/9osh79xluhgoyeq/cornell_buildings_w_trees.csv?dl=1</code></pre></div>

<p>You should see something like this:</p>

<p><img src="http://i.imgur.com/I4JdBRR.png" alt="multilayer map" /></p>

<h3 id="choropleth-the-new-layer-on-treesperlength">Choropleth the new layer on <code>trees_per_length</code></h3>

<p><img src="http://i.imgur.com/eCwu0Y3.png" alt="choropleth" /></p>

<h4 id="customizing-legends">Customizing legends</h4>

<p><img src="http://i.imgur.com/p5IT52J.png" alt="customize legend" /></p>

<h4 id="customizing-infowindows-and-hovers">Customizing infowindows and hovers</h4>

<p><img src="http://i.imgur.com/UNeP4UV.gif" alt="customizing infowindows and hovers" /></p>

<h4 id="annotations">Annotations</h4>
<p><img src="http://i.imgur.com/22pOKzM.gif" alt="adding annotations" /></p>

<h4 id="basemaps">Basemaps</h4>

<p><img src="http://i.imgur.com/XiYrJW5.png" alt="basemaps" /></p>

<h4 id="sharing-your-map">Sharing your map</h4>

<p><img src="http://i.imgur.com/KF1ruSf.png" alt="sharing" /></p>

<h2 id="advanced-class">Advanced Class</h2>

<h3 id="crash-course-on-our-apis">Crash Course on our APIs</h3>

<p>Thompson County Building dataset from
http://cugir.mannlib.cornell.edu/mapsheet.jsp?code=109&amp;code=tcco</p>

<p>Get buildings that are only (geospatially) close to the trees.</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">tb</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span>
  <span class="n">tomp_building_2014</span> <span class="n">tb</span>
<span class="k">WHERE</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">ST_Extent</span><span class="p">(</span><span class="n">ct</span><span class="p">.</span><span class="n">the_geom</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">cornell_trees</span> <span class="n">ct</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">tb</span><span class="p">.</span><span class="n">the_geom</span></code></pre></div>

<p>Clear that query to reset your map.</p>

<p>To alter our dataset to only include buildings near Cornell, we need to delete them. We can do this with:</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span>
  <span class="n">tomp_building_2014</span> <span class="n">tb</span>
<span class="k">WHERE</span> <span class="k">NOT</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">ST_Extent</span><span class="p">(</span><span class="n">ct</span><span class="p">.</span><span class="n">the_geom</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">cornell_trees</span> <span class="n">ct</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">tb</span><span class="p">.</span><span class="n">the_geom</span></code></pre></div>

<p>Count the number of trees with 10 meters of a building</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">tomp_building_2014</span> 
<span class="k">SET</span> <span class="n">num_adj_trees</span> <span class="o">=</span> <span class="p">(</span>
  <span class="k">SELECT</span> 
     <span class="k">count</span><span class="p">(</span><span class="n">ct</span><span class="p">.</span><span class="o">*</span><span class="p">)</span>
  <span class="k">FROM</span> 
  	 <span class="n">cornell_trees</span> <span class="n">ct</span>
  <span class="k">WHERE</span> 
    <span class="n">ST_DWithin</span><span class="p">(</span>
	  <span class="n">ct</span><span class="p">.</span><span class="n">the_geom</span><span class="p">::</span><span class="n">geography</span><span class="p">,</span>
      <span class="n">tomp_building_2014</span><span class="p">.</span><span class="n">the_geom</span><span class="p">::</span><span class="n">geography</span><span class="p">,</span>
	  <span class="mi">10</span><span class="p">,</span>
      <span class="k">false</span>
    <span class="p">)</span>
<span class="p">)</span></code></pre></div>

<p>Find the number of trees per 100 feet perimeter. First create a new column called <code>num_trees_per_length</code></p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">tomp_building_2014</span>
<span class="k">SET</span> <span class="n">num_trees_per_length</span> <span class="o">=</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">num_adj_trees</span> <span class="o">/</span> <span class="n">shape_length</span></code></pre></div>

<h3 id="building-maps-with-javascript">Building maps with JavaScript</h3>

<p>Download our <a href="https://raw.githubusercontent.com/CartoDB/academy/master/t/03-cartodbjs-ground-up/lesson-1/CartoDB-js-lesson1-template.html">HTML template</a> and save it to your desktop. (Right click and save as…)</p>

<p>Open that file with a text editor such as Notepad.</p>

<p>Between the <code>&lt;script&gt;</code> tags, drop in this line of code:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">cartodb</span><span class="p">.</span><span class="nx">createVis</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span></code></pre></div>

<p>Go back to your CartoDB map, click on “Share”, and copy the viz.json url. Paste it between the single quotes in the second argument above.</p>

<p>You can use mine if you can’t get to yours:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html">https://team.cartodb.com/u/eschbacher/api/v2/viz/a285e9f8-f771-11e4-b819-0e4fddd5de28/viz.json</code></pre></div>

<h2 id="resources-to-help-you-make-maps">Resources to help you make maps</h2>
<ol>
  <li><a href="http://academy.cartodb.com">Map Academy</a> is a site I run
    <ul>
      <li><a href="http://academy.cartodb.com/courses/01-beginners-course.html">Beginner</a></li>
      <li><a href="http://academy.cartodb.com/courses/02-design-for-beginners.html">Map design</a></li>
      <li><a href="http://academy.cartodb.com/courses/03-cartodbjs-ground-up/lesson-3.html">CartoDB.js</a> – build a web app to visualize your data, allowing for more user interaction</li>
      <li><a href="http://academy.cartodb.com/courses/04-sql-postgis.html">SQL and PostGIS</a> – slice and dice your geospatial data</li>
    </ul>
  </li>
  <li><a href="http://docs.cartodb.com/tutorials.html">CartoDB Tutorials</a></li>
  <li><a href="http://docs.cartodb.com/cartodb-editor.html">CartoDB Editor Documentation</a></li>
  <li><a href="http://docs.cartodb.com/cartodb-platform.html">CartoDB APIs</a></li>
  <li><a href="http://gis.stackexchange.com/questions/tagged/cartodb">Community help on StackExchange</a></li>
  <li><a href="http://cartodb.com/gallery/">CartoDB Map Gallery</a></li>
</ol>

<h2 id="thanks">Thanks!!</h2>
<p>If you make a cool map, send it my way :)</p>

<p>Email: eschbacher@cartodb.com
Twitter: <a href="https://twitter.com/MrEPhysics">@MrEPhysics</a></p>



                    </div>
                
            </div>

            

            <div class=row-fluid>
                <div id=footer class=span12>
                    Documentation for <a href="https://github.com/ryan-m-cooper/tutorials">Tuts &amp; Lessons</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
    </body>
</html>
